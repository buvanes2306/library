<!DOCTYPE html>
<html>
<head>
    <title>üîç Dropdown Verification Guide</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f0f8ff; }
        .success { background: #d4edda; color: #155724; padding: 20px; border-radius: 10px; margin: 10px 0; }
        .warning { background: #fff3cd; color: #856404; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .error { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .fix { background: #e3f2fd; color: #004085; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .test { background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 5px; }
        .code { background: #f1f3f4; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; }
        .status { background: #e9ecef; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .tip { background: #d1ecf1; color: #0c5460; padding: 15px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üîç Dropdown Verification Guide</h1>
    
    <div class="success">
        <h2>‚úÖ Your Dropdowns Are Already Implemented!</h2>
        <p><strong>Status:</strong> Rack and Shelf dropdowns are in AuditPage.jsx</p>
        <p><strong>Location:</strong> Lines 229-280 in the Controls section</p>
        <p><strong>Features:</strong> Dynamic loading, book counts, smart filtering</p>
    </div>

    <div class="fix">
        <h3>üéØ Current Implementation Status</h3>
        
        <h4>‚úÖ What's Already Working:</h4>
        <div class="code">
// State variables (lines 31-32)
const [locations, setLocations] = useState([])
const [locationsWithCounts, setLocationsWithCounts] = useState([])

// API fetching (lines 44-59)
useEffect(() => {
  fetchLocations()
}, [])

const fetchLocations = async () => {
  try {
    const [locationsResponse, countsResponse] = await Promise.all([
      api.get('/locations'),
      api.get('/locations-with-counts')
    ])
    setLocations(locationsResponse.data)
    setLocationsWithCounts(countsResponse.data)
  } catch (error) {
    console.error('Fetch locations error:', error)
    toast.error('Failed to load locations')
  }
}

// Rack dropdown (lines 230-249)
<select
  value={currentRack}
  onChange={(e) => {
    setCurrentRack(e.target.value)
    setCurrentShelf('')
  }}
  className="input-field"
>
  <option value="">Select Rack</option>
  {locationsWithCounts.map(loc => (
    <option key={loc.rack} value={loc.rack}>
      Rack {loc.rack} ({loc.totalBooks} books, {loc.shelves.length} shelves)
    </option>
  ))}
</select>

// Shelf dropdown (lines 254-269)
<select
  value={currentShelf}
  onChange={(e) => setCurrentShelf(e.target.value)}
  disabled={!currentRack}
  className="input-field"
>
  <option value="">Select Shelf</option>
  {selectedRackWithCounts?.shelves.map(shelf => (
    <option key={shelf.shelf} value={shelf.shelf}>
      Shelf {shelf.shelf} ({shelf.bookCount} books)
    </option>
  ))}
</select>
        </div>
    </div>

    <div class="test">
        <h3>üß™ Step-by-Step Verification</h3>
        
        <h4>üéØ Step 1: Check Backend API</h4>
        <div class="code">
# Test if backend is running
curl http://localhost:5002/api/health

# Expected: {"status":"OK","timestamp":"..."}

# Test locations API
curl http://localhost:5002/api/locations

# Expected (example):
[
  {"rack":1,"shelves":[4,5,7,59,60]},
  {"rack":2,"shelves":[1,4,5,27,34,35]}
]

# Test enhanced API
curl http://localhost:5002/api/locations-with-counts

# Expected (example):
[
  {
    "rack":1,
    "shelves":[
      {"shelf":4,"bookCount":28},
      {"shelf":5,"bookCount":15}
    ],
    "totalBooks":43
  }
]
        </div>
        
        <h4>üéØ Step 2: Check Frontend</h4>
        <div class="code">
# Navigate to audit page
http://localhost:5173/audit

# What you should see:
1. "Start New Audit Session" button
2. Click it ‚Üí Audit session starts
3. Dropdowns appear in "Audit Controls" section
4. Rack dropdown shows: "Rack 1 (95 books, 5 shelves)"
5. Shelf dropdown is disabled initially
6. Select rack ‚Üí Shelf dropdown enables
7. Shelf dropdown shows: "Shelf 4 (28 books)"
        </div>
        
        <h4>üéØ Step 3: Debug Console</h4>
        <div class="code">
# Open browser console (F12)
# Look for these logs:

// Successful API calls:
console.log(locationsResponse.data)
console.log(countsResponse.data)

// Error messages:
"Fetch locations error:"
"Failed to load locations"

// Network tab should show:
GET /api/locations ‚Üí 200
GET /api/locations-with-counts ‚Üí 200
        </div>
    </div>

    <div class="warning">
        <h3>üö® Troubleshooting Common Issues</h3>
        
        <h4>‚ùå Issue 1: Dropdowns Not Visible</h4>
        <div class="code">
# Possible causes:
1. Backend not running
2. No audit session started
3. API calls failing
4. No books with location data

# Solutions:
1. Start backend: cd d:/lib/backend && npm start
2. Start frontend: cd d:/lib/frontend && npm run dev
3. Click "Start New Audit Session" first
4. Check if books have location.rack and location.shelf
        </div>
        
        <h4>‚ùå Issue 2: Dropdowns Empty</h4>
        <div class="code">
# Possible causes:
1. API returning empty array
2. Books have null/undefined locations
3. MongoDB connection issues

# Debug steps:
1. Check API responses directly
2. Verify book data in MongoDB
3. Check console for errors
4. Add debug logging:
   console.log('Locations:', locations)
   console.log('Counts:', locationsWithCounts)
        </div>
        
        <h4>‚ùå Issue 3: Shelf Dropdown Not Updating</h4>
        <div class="code">
# Possible causes:
1. selectedRackWithCounts not updating
2. String comparison issue
3. Data structure mismatch

# Debug steps:
1. Add console.log('Selected rack:', selectedRackWithCounts)
2. Check currentRack value type
3. Verify data structure matches expected format
        </div>
    </div>

    <div class="tip">
        <h3>üìã Quick Test Checklist</h3>
        
        <h4>‚úÖ Before Testing:</h4>
        <ul>
            <li>‚ñ° Backend server running on port 5002</li>
            <li>‚ñ° Frontend dev server running on port 5173</li>
            <li>‚ñ° MongoDB connected with book data</li>
            <li>‚ñ° Books have location.rack and location.shelf fields</li>
        </ul>
        
        <h4>‚úÖ During Testing:</h4>
        <ul>
            <li>‚ñ° Navigate to http://localhost:5173/audit</li>
            <li>‚ñ° Click "Start New Audit Session"</li>
            <li>‚ñ° Verify rack dropdown appears</li>
            <li>‚ñ° Select a rack</li>
            <li>‚ñ° Verify shelf dropdown updates</li>
            <li>‚ñ° Check book counts display correctly</li>
        </ul>
        
        <h4>‚úÖ Expected Results:</h4>
        <div class="code">
Rack dropdown shows:
- Rack 1 (95 books, 5 shelves)
- Rack 2 (101 books, 6 shelves)
- Rack 7 (42 books, 3 shelves)

Shelf dropdown (when Rack 1 selected):
- Shelf 4 (28 books)
- Shelf 5 (15 books)
- Shelf 7 (32 books)
- Shelf 59 (8 books)
- Shelf 60 (12 books)

Scan button:
- Disabled until both rack and shelf selected
- Shows "Scan Shelf 1-4" when ready
        </div>
    </div>

    <div class="success">
        <h3>üéâ Your Implementation Is Complete!</h3>
        
        <h4>‚úÖ What You Have:</h4>
        <ul>
            <li><strong>üèóÔ∏è Backend:</strong> Two API endpoints for locations</li>
            <li><strong>üé®Ô∏è Frontend:</strong> Dynamic dropdowns with book counts</li>
            <li><strong>‚ö° Performance:</strong> Parallel API calls</li>
            <li><strong>üéØ UX:</strong> Smart state management</li>
            <li><strong>üìä Data:</strong> Real-time book counts</li>
        </ul>
        
        <h4>‚úÖ If It's Not Working:</h4>
        <ol>
            <li>Start both servers (backend + frontend)</li>
            <li>Navigate to audit page</li>
            <li>Click "Start New Audit Session"</li>
            <li>Check browser console for errors</li>
            <li>Test API endpoints directly</li>
            <li>Verify book data has location fields</li>
        </ol>
        
        <h4>‚úÖ Expected Flow:</h4>
        <div class="code">
1. Open http://localhost:5173/audit
2. Click "Start New Audit Session"
3. See rack dropdown with book counts
4. Select rack ‚Üí shelf dropdown enables
5. Select shelf ‚Üí scan button enables
6. Click scan ‚Üí audit process starts
        </div>
        
        <p><strong>üî• Your dropdowns are ready to test!</strong></p>
    </div>

    <script>
        // Quick API test
        fetch('http://localhost:5002/api/health')
            .then(response => response.json())
            .then(data => {
                document.body.innerHTML += '<div class="success">‚úÖ Backend is running!</div>';
            })
            .catch(() => {
                document.body.innerHTML += '<div class="warning">‚ö†Ô∏è Backend not running - start with: cd d:/lib/backend && npm start</div>';
            });
            
        fetch('http://localhost:5173/audit')
            .then(() => {
                document.body.innerHTML += '<div class="success">‚úÖ Frontend is accessible!</div>';
            })
            .catch(() => {
                document.body.innerHTML += '<div class="warning">‚ö†Ô∏è Frontend not running - start with: cd d:/lib/frontend && npm run dev</div>';
            });
    </script>
</body>
</html>
